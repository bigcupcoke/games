<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>breakout</title>
        <style media="screen">
            body {
                background-color: darkslategrey;
            }
            canvas {
                border: 1px solid gray;
            }
        </style>
        <script src="utils.js" charset="utf-8"></script>
        <script src="paddle.js" charset="utf-8"></script>
        <script src="ball.js" charset="utf-8"></script>
        <script src="block.js" charset="utf-8"></script>
        <script src="game.js" charset="utf-8"></script>
    </head>
    <body>
        <canvas id="dj-canvas" width="500" height="400"></canvas>
        <script type="text/javascript">

            var paused = false
            var pause = function() {
                window.addEventListener('keydown', function(e) {
                    if (e.key === 'p') {
                        paused = !paused
                    }
                })
            }


            var __main = function() {

                pause()

                var paddle = Paddle()

                var game = Game()
                game.registerAction('a', paddle.moveLeft)
                game.registerAction('d', paddle.moveRight)

                var ball = Ball()
                game.registerAction('f', ball.fire)


                var blocks = []
                for (var i = 0; i < 80; i++) {
                    var b = Block()
                    //  set X, Y
                    var x = i % 17
                    b.x = Math.random() * 1000
                    b.y = Math.random() * 300
                    blocks.push(b)
                }

                game.update = function() {
                    if (paused) {
                        return
                    }
                    ball.move()

                    if (paddle.collide(ball)) {
                        ball.bound()
                    }

                    for (var i = 0; i < blocks.length; i++) {
                        var b = blocks[i]
                        if(b.collide(ball)) {
                            ball.boundY()
                            b.kill()
                        }
                    }

                }

                game.draw = function() {
                    game.drawImg(paddle)
                    game.drawImg(ball)

                    for (var i = 0; i < blocks.length; i++) {
                        var b = blocks[i]
                        if (b.alive) {
                            game.drawImg(b)
                        }
                    }
                }
            }

             __main()
        </script>
    </body>
</html>
